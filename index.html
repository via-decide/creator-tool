<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Decide Engine Course Builder</title>
  <style>
    :root { --bg:#0b0d10; --panel:#12161c; --text:#e8eef7; --muted:#a8b3c2; --line:#243041; --acc:#7dd3fc; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text); }
    header{ padding:16px 20px; border-bottom:1px solid var(--line); position:sticky; top:0; background:rgba(11,13,16,.9); backdrop-filter: blur(8px); }
    h1{ margin:0; font-size:16px; font-weight:700; letter-spacing:.2px; }
    main{ padding:18px 20px 50px; max-width:1200px; margin:0 auto; }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }
    .card{ background:var(--panel); border:1px solid var(--line); border-radius:14px; padding:14px; }
    label{ display:block; font-size:12px; color:var(--muted); margin:10px 0 6px; }
    input, textarea, select{
      width:100%; border-radius:12px; border:1px solid var(--line);
      background:#0f1318; color:var(--text); padding:10px 12px; outline:none;
    }
    textarea{ min-height:120px; resize:vertical; line-height:1.35; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex:1; min-width: 200px; }
    .btn{
      border:1px solid var(--line); background:#0f1318; color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600;
    }
    .btn:hover{ border-color:#365071; }
    .btn.primary{ border-color:#2b6b83; background: linear-gradient(180deg, rgba(125,211,252,.14), rgba(125,211,252,.04)); }
    .btn.danger{ border-color:#7a2d2d; }
    .small{ font-size:12px; color:var(--muted); }
    .outHead{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .outHead h2{ margin:0; font-size:14px; }
    pre{
      white-space:pre-wrap; word-wrap:break-word;
      background:#0f1318; border:1px solid var(--line); border-radius:12px;
      padding:12px; margin:0;
    }
    .pill{ display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid var(--line); color:var(--muted); font-size:12px; }
    footer{ margin-top:18px; }
  </style>
</head>
<body>
<header>
  <h1>Decide Engine — Topic → (Problem + Solution) Generator</h1>
</header>

<main class="grid">
  <section class="card">
    <div class="row">
      <div>
        <label>Course / Playlist Name</label>
        <input id="courseName" placeholder="Decision Systems for Modern Operators" />
      </div>
      <div>
        <label>Module #</label>
        <input id="moduleNo" placeholder="01" />
      </div>
    </div>

    <label>Topic (single line)</label>
    <input id="topic" placeholder="Incentives Beat Intelligence" />

    <div class="row">
      <div>
        <label>Audience</label>
        <input id="audience" placeholder="operators (builders, founders, engineers)" />
      </div>
      <div>
        <label>Tone</label>
        <select id="tone">
          <option value="operator">Operator / clinical</option>
          <option value="teaching">Teaching / structured</option>
          <option value="debate">Debate / contrarian but safe</option>
        </select>
      </div>
    </div>

    <label>Bullet points (one per line)</label>
    <textarea id="bullets" placeholder="e.g.
- Incentives determine behavior
- Hidden metrics drive real decisions
- Goodhart's Law failure modes"></textarea>

    <div class="row">
      <button class="btn primary" id="generateBtn">Generate Outputs</button>
      <button class="btn" id="saveBtn">Save</button>
      <button class="btn" id="loadBtn">Load</button>
      <button class="btn danger" id="resetBtn">Reset</button>
    </div>

    <label>NotebookLM Source Pack Prompt (auto-filled)</label>
    <textarea id="notebookPrompt"></textarea>

    <div class="row">
      <button class="btn" id="copyPromptBtn">Copy Prompt</button>
      <button class="btn" id="exportBtn">Export JSON</button>
      <button class="btn" id="importBtn">Import JSON</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" />
    </div>

    <p class="small">
      Notes: This tool uses localStorage only. No network calls. Works offline.
    </p>
  </section>

  <section class="card">
    <div class="outHead">
      <h2>Outputs</h2>
      <span class="pill" id="statusPill">idle</span>
    </div>

    <div style="display:grid; gap:12px;">
      <div>
        <div class="outHead">
          <h2>Problem Video Script</h2>
          <button class="btn" data-copy="problemScript">Copy</button>
        </div>
        <pre id="problemScript"></pre>
      </div>

      <div>
        <div class="outHead">
          <h2>Solution Video Script</h2>
          <button class="btn" data-copy="solutionScript">Copy</button>
        </div>
        <pre id="solutionScript"></pre>
      </div>

      <div>
        <div class="outHead">
          <h2>YouTube Post</h2>
          <button class="btn" data-copy="ytPost">Copy</button>
        </div>
        <pre id="ytPost"></pre>
      </div>

      <div>
        <div class="outHead">
          <h2>Visual Guide (Problem + Solution)</h2>
          <button class="btn" data-copy="visualGuide">Copy</button>
        </div>
        <pre id="visualGuide"></pre>
      </div>

      <div>
        <div class="outHead">
          <h2>A/B Test Posts (2 variants)</h2>
          <button class="btn" data-copy="abPosts">Copy</button>
        </div>
        <pre id="abPosts"></pre>
      </div>
    </div>

    <footer class="small">
      Tip: Keep bullets concrete (mechanisms, constraints, examples). Avoid adjectives.
    </footer>
  </section>
</main>

<script>
(function(){
  const $ = (id) => document.getElementById(id);

  const STORAGE_KEY = "decide_engine_course_builder_v1";

  function nowISO(){
    return new Date().toISOString();
  }

  function sanitizeLines(text){
    return (text || "")
      .split("\n")
      .map(l => l.replace(/^\s*[-*]\s?/, "").trim())
      .filter(Boolean);
  }

  function titleCase(s){
    return (s||"").trim();
  }

  function buildNotebookPrompt(topic, angle, audience){
    return `You are my research analyst. Build a “Source Pack” for the topic below using only reliable sources.

Topic: ${topic}
Angle: ${angle}
Audience: ${audience}

Goal outputs:
1) 10–15 sources grouped by credibility tier
2) For each source: 2–5 bullet takeaways + why it matters
3) Conflicts/Disagreements between sources (if any)
4) Recency check: note the publication year and whether newer research exists
5) Key terms definitions (clear, non-hype)
6) Evidence map: claims → supporting sources

Source rules (strict):
- Prefer peer-reviewed papers, university publications, standards bodies, official docs, reputable books, and high-quality journalism.
- Avoid low-signal blogs, anonymous posts, motivational content.
- Include at least:
  - 3 peer-reviewed / academic sources
  - 2 books or book chapters (credible publishers)
  - 2 high-quality industry reports / standards / official docs
- If sources disagree, summarize both sides and the strength of evidence.

Reliability scoring (0–5):
- 5 = peer-reviewed / official standard / primary data
- 4 = university / major publisher book / reputable institution report
- 3 = reputable journalism / expert consensus summaries
- 0–2 = avoid unless uniquely necessary

Deliver in this structure:
- Tier 1 (5/5): …
- Tier 2 (4/5): …
- Tier 3 (3/5): …
- Evidence map
- Contradictions & uncertainty
- “What not to claim” (claims not supported strongly enough)

Do not write the script yet. Only build the Source Pack.`;
  }

  function buildProblemScript(ctx){
    const bullets = ctx.bullets;
    const b = bullets.map(x => `- ${x}`).join("\n");

    return `TITLE: ${ctx.moduleLabel} — ${ctx.topic} (Problem)

OPEN (0:00–0:20)
- Claim: Most people misdiagnose ${ctx.topic.toLowerCase()} and treat symptoms as causes.
- Promise: You’ll leave with a clean failure-map, not “tips”.

CONTEXT (0:20–1:10)
- Who this is for: ${ctx.audience}
- What this is NOT: motivation, self-improvement, generic advice.

THE FAILURE MAP (1:10–5:30)
Explain the mechanism that causes failure. Use concrete examples.
Anchor points from your bullets:
${b}

WHY COMMON ADVICE FAILS (5:30–7:00)
- Identify 2–3 popular approaches.
- Show how they break under incentives, constraints, and second-order effects.

COST OF FAILURE (7:00–8:00)
- Time loss / money loss / reputation loss / opportunity loss.
- Make the cost legible.

TRANSITION (8:00–8:20)
- “In the next video, we build the system: inputs, rules, and a repeatable checklist.”`;
  }

  function buildSolutionScript(ctx){
    const bullets = ctx.bullets;
    const b = bullets.map((x,i) => `${i+1}) ${x}`).join("\n");

    return `TITLE: ${ctx.moduleLabel} — ${ctx.topic} (Solution)

OPEN (0:00–0:25)
- Goal: Convert ${ctx.topic.toLowerCase()} into a repeatable decision system.
- Output: a checklist + a simple model you can run weekly.

SYSTEM OVERVIEW (0:25–1:20)
- Inputs → Filters → Decision → Feedback loop
- Define success metric (one sentence).

THE SYSTEM (1:20–7:30)
Use the bullets as system steps, rules, or constraints:
${b}

WORKED EXAMPLE (7:30–9:00)
- Show a realistic scenario.
- Run it through the system step-by-step.
- State what the system rejects and why.

FAIL-SAFES (9:00–10:00)
- Kill criteria
- Reversibility check
- Disconfirmation step (what would prove this wrong?)

CLOSE (10:00–10:20)
- Summary in 3 lines
- Point to Source Pack / notebook for evidence map.`;
  }

  function buildYTPost(ctx){
    const hooks = [
      `Most people misunderstand ${ctx.topic.toLowerCase()}.`,
      `${ctx.topic} isn’t a mindset problem. It’s a system problem.`,
      `If you don’t model incentives/constraints, ${ctx.topic.toLowerCase()} becomes noise.`
    ];

    return `${hooks[0]}

Module ${ctx.moduleNo}: ${ctx.topic}
- Video 1: Problem (failure map)
- Video 2: Solution (repeatable system + checklist)

Key ideas:
${ctx.bullets.map(x=>`• ${x}`).join("\n")}

Source Pack (NotebookLM): link in description
#decideengine #decisionsystems`;
  }

  function buildVisualGuide(ctx){
    const steps = ctx.bullets.length ? ctx.bullets : ["Define the failure", "Model constraints", "Build checklist", "Add feedback loop"];
    const flow = `INPUTS → FILTERS → DECISION → FEEDBACK`;

    return `VISUAL GUIDE — ${ctx.moduleLabel}: ${ctx.topic}

PROBLEM VIDEO VISUALS
1) “Failure Map” slide:
   - Symptom → Mechanism → Root cause
2) “Why advice fails” slide:
   - Advice A → breaks because ___
   - Advice B → breaks because ___
3) “Cost of failure” slide:
   - Time / Money / Reputation / Opportunity

SOLUTION VIDEO VISUALS
1) System diagram:
   ${flow}
2) Checklist slide (show on screen):
   ${steps.map((s,i)=>`${i+1}. ${s}`).join("\n   ")}
3) Worked example table:
   - Scenario | Input | Filter result | Decision | Next check date

THUMBNAIL / TITLE FORMAT
- Problem: “Why ${ctx.topic} Fails”
- Solution: “The ${ctx.topic} System”`;
  }

  function buildABPosts(ctx){
    const a = `A) People don’t fail because they lack discipline.
They fail because their system is mis-specified.

Module ${ctx.moduleNo}: ${ctx.topic}
Problem video: failure map → why common advice breaks
Solution video: decision system → checklist → worked example`;

    const b = `B) If your results are inconsistent, your decision rules are inconsistent.

Module ${ctx.moduleNo}: ${ctx.topic}
Video 1: diagnose the mechanism
Video 2: install the system`;

    return `${a}\n\n---\n\n${b}`;
  }

  function buildModuleLabel(courseName, moduleNo){
    const no = (moduleNo||"").toString().trim() || "01";
    return `${courseName} / Module ${no.padStart(2,"0")}`;
  }

  function getCtx(){
    const courseName = titleCase($("courseName").value || "Decision Systems for Modern Operators");
    const moduleNo = ($("moduleNo").value || "01").trim();
    const topic = titleCase($("topic").value || "Untitled Topic");
    const audience = ($("audience").value || "operators (builders, founders, engineers)").trim();
    const tone = $("tone").value;
    const bullets = sanitizeLines($("bullets").value);

    return {
      courseName, moduleNo, topic, audience, tone, bullets,
      moduleLabel: buildModuleLabel(courseName, moduleNo)
    };
  }

  function setStatus(text){
    $("statusPill").textContent = text;
  }

  function generate(){
    const ctx = getCtx();

    $("notebookPrompt").value = buildNotebookPrompt(ctx.topic, "PROBLEM (diagnosis + failure map)", ctx.audience);

    $("problemScript").textContent = buildProblemScript(ctx);
    $("solutionScript").textContent = buildSolutionScript(ctx);
    $("ytPost").textContent = buildYTPost(ctx);
    $("visualGuide").textContent = buildVisualGuide(ctx);
    $("abPosts").textContent = buildABPosts(ctx);

    setStatus("generated " + nowISO().slice(0,19).replace("T"," "));
    persist();
  }

  function persist(){
    const ctx = getCtx();
    const payload = {
      savedAt: nowISO(),
      ...ctx,
      rawBullets: $("bullets").value,
      notebookPrompt: $("notebookPrompt").value,
      outputs: {
        problemScript: $("problemScript").textContent,
        solutionScript: $("solutionScript").textContent,
        ytPost: $("ytPost").textContent,
        visualGuide: $("visualGuide").textContent,
        abPosts: $("abPosts").textContent
      }
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
  }

  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){ setStatus("no saved data"); return; }
    const data = JSON.parse(raw);

    $("courseName").value = data.courseName || "";
    $("moduleNo").value = data.moduleNo || "";
    $("topic").value = data.topic || "";
    $("audience").value = data.audience || "";
    $("tone").value = data.tone || "operator";
    $("bullets").value = data.rawBullets || "";

    $("notebookPrompt").value = data.notebookPrompt || "";
    $("problemScript").textContent = data.outputs?.problemScript || "";
    $("solutionScript").textContent = data.outputs?.solutionScript || "";
    $("ytPost").textContent = data.outputs?.ytPost || "";
    $("visualGuide").textContent = data.outputs?.visualGuide || "";
    $("abPosts").textContent = data.outputs?.abPosts || "";

    setStatus("loaded " + (data.savedAt ? data.savedAt.slice(0,19).replace("T"," ") : ""));
  }

  function resetAll(){
    if(!confirm("Reset all fields and clear saved data?")) return;
    localStorage.removeItem(STORAGE_KEY);
    ["courseName","moduleNo","topic","audience","bullets","notebookPrompt"].forEach(id => $(id).value = "");
    ["problemScript","solutionScript","ytPost","visualGuide","abPosts"].forEach(id => $(id).textContent = "");
    setStatus("reset");
  }

  async function copyFrom(id){
    const text = $(id).value ?? $(id).textContent ?? "";
    try{
      await navigator.clipboard.writeText(text);
      setStatus("copied " + id);
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      setStatus("copied (fallback) " + id);
    }
  }

  function exportJSON(){
    const raw = localStorage.getItem(STORAGE_KEY) || JSON.stringify({ note:"nothing saved yet" });
    const blob = new Blob([raw], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "decide_engine_generator_export.json";
    a.click();
    URL.revokeObjectURL(a.href);
    setStatus("exported json");
  }

  function importJSON(file){
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(reader.result);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        load();
        setStatus("imported json");
      }catch(e){
        alert("Invalid JSON file.");
        setStatus("import failed");
      }
    };
    reader.readAsText(file);
  }

  // wire up
  $("generateBtn").addEventListener("click", generate);
  $("saveBtn").addEventListener("click", () => { persist(); setStatus("saved " + nowISO().slice(0,19).replace("T"," ")); });
  $("loadBtn").addEventListener("click", load);
  $("resetBtn").addEventListener("click", resetAll);

  $("copyPromptBtn").addEventListener("click", () => copyFrom("notebookPrompt"));

  document.querySelectorAll("[data-copy]").forEach(btn=>{
    btn.addEventListener("click", () => copyFrom(btn.getAttribute("data-copy")));
  });

  $("exportBtn").addEventListener("click", exportJSON);
  $("importBtn").addEventListener("click", () => $("importFile").click());
  $("importFile").addEventListener("change", (e) => {
    const f = e.target.files && e.target.files[0];
    if(f) importJSON(f);
    e.target.value = "";
  });

  // autosave on change
  ["courseName","moduleNo","topic","audience","tone","bullets"].forEach(id=>{
    $(id).addEventListener("input", () => { persist(); setStatus("autosaved"); });
    $(id).addEventListener("change", () => { persist(); setStatus("autosaved"); });
  });

  // initial
  load();
  if(!$("notebookPrompt").value){
    const ctx = getCtx();
    $("notebookPrompt").value = buildNotebookPrompt(ctx.topic || "{TOPIC}", "PROBLEM (diagnosis + failure map)", ctx.audience || "{AUDIENCE}");
  }
})();
</script>
</body>
</html>
